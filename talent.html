<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>نموذج تسجيل الموهبة</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
    body { font-family: 'Cairo', sans-serif; background: #f0f8ff; margin:0; padding:0; }
    header { background: #0b2545; color: #fff; padding:20px; text-align:center; }
    nav { background:#0f4c75; padding:10px; display:flex; justify-content:center; gap:15px; }
    nav a { color:#fff; text-decoration:none; font-weight:bold; }
    .container { max-width:600px; margin:40px auto; background:#fff; padding:30px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); position:relative; }
    label { display:block; margin-bottom:6px; font-weight:bold; }
    input, select, textarea, button { width:100%; padding:10px; margin-bottom:20px; border-radius:5px; border:1px solid #ccc; }
    button { background:#f28c00; color:#fff; border:none; cursor:pointer; font-size:16px; }
    button:hover { background:#ffa500; }
    .hidden { display:none; }
    /* Modal overlay styling */
    .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); align-items:center; justify-content:center; }
    .modal-content { background:#fff; padding:20px; border-radius:8px; text-align:center; max-width:300px; width:90%; }
    .modal-content button { margin-top:15px; }
    /* Questions style */
    #questionSection { margin-top:20px; }
    #questionSection label { margin-top:15px; }
  </style>
</head>
<body>
  <!-- Header and Navigation -->
  <header>
    <h1>نموذج تسجيل الموهبة</h1>
  </header>
  <nav>
    <a href="index.html">الرئيسية</a>
    <a href="index.html#about">من نحن</a>
    <a href="contact.html">تواصل معنا</a>
  </nav>

  <div class="container">
    <!-- Main form -->
    <form id="talentForm">
      <label for="name">الاسم الكامل</label>
      <input type="text" id="name" name="name" required>

      <label for="email">البريد الإلكتروني</label>
      <input type="email" id="email" name="email" required>

      <label for="age">العمر</label>
      <input type="number" id="age" name="age" required>

      <label for="talent">الموهبة</label>
      <select id="talent" name="talent">
        <option value="">-- اختر الموهبة --</option>
        <option value="football">كرة القدم</option>
        <option value="basketball">كرة السلة</option>
        <option value="swimming">السباحة</option>
        <option value="running">الجري</option>
        <option value="volleyball">كرة الطائرة</option>
        <option value="other">أخرى</option>
      </select>
      <!-- Hidden input for 'other' talent -->
      <input type="text" id="otherTalent" name="otherTalent" placeholder="اكتب هويتك هنا" class="hidden">

      <label for="height">الطول (سم)</label>
      <input type="number" id="height" name="height" required>

      <label for="weight">الوزن (كجم)</label>
      <input type="number" id="weight" name="weight" required>

      <button type="submit">إرسال</button>
    </form>

    <!-- Dynamic questions section -->
    <div id="questionSection" class="hidden">
      <h2>أسئلة إضافية</h2>
      <form id="questionsForm"></form>
    </div>
  </div>

  <!-- Success modal -->
  <div id="successModal" class="modal">
    <div class="modal-content">
      <p>تم إرسال بياناتك بنجاح وهي قيد المراجعة.</p>
      <button id="closeModal">حسنًا</button>
    </div>
  </div>

  <script>
    // URL to Google Apps Script Web App endpoint
    const SHEET_ENDPOINT = 'https://script.google.com/macros/s/AKfycbyzUrGRF4lDc0xVVWk1CKUWKk5Bg0fmGUXMQjlzqMQFC8OSs_9t99GSzqO0SgQsKwlT/exec';

    // Fetch questions JSON and initialize form only after loading
    async function init() {
      let talentQuestions = {};
      try {
        // Load external JSON mapping
        const resp = await fetch('talentQuestions.json');
        talentQuestions = await resp.json();
      } catch (e) {
        console.error('فشل تحميل ملف JSON:', e);
      }

      // DOM elements
      const talentSelect = document.getElementById('talent');
      const otherInput = document.getElementById('otherTalent');
      const form = document.getElementById('talentForm');
      const qSection = document.getElementById('questionSection');
      const qForm = document.getElementById('questionsForm');

      // Show/hide 'other' text input on change
      talentSelect.addEventListener('change', e => {
        if (e.target.value === 'other') {
          otherInput.classList.remove('hidden');
          otherInput.required = true;
        } else {
          otherInput.classList.add('hidden');
          otherInput.required = false;
        }
      });

      // Handle first form submission
      form.addEventListener('submit', e => {
        e.preventDefault();
        // Determine selected talent (or custom)
        const rawVal = talentSelect.value;
        const talentValue = rawVal === 'other' ? otherInput.value.trim() : rawVal;
        if (!talentValue) {
          return alert('يرجى اختيار الموهبة أو كتابتها');
        }

        // Hide initial form, show questions
        form.classList.add('hidden');
        qSection.classList.remove('hidden');

        // Populate questions dynamically
        qForm.innerHTML = '';
        const questions = talentQuestions[talentValue] || talentQuestions['other'] || [];
        questions.forEach((q, idx) => {
          // Create label + input for each question
          const lbl = document.createElement('label');
          lbl.innerText = q;
          const inp = document.createElement('input');
          inp.type = 'text';
          inp.name = 'q' + (idx + 1);
          inp.required = true;
          qForm.appendChild(lbl);
          qForm.appendChild(inp);
        });

        // Add a submit button for the questions form
        const submitBtn = document.createElement('button');
        submitBtn.type = 'submit';
        submitBtn.innerText = 'إرسال التقييم';
        qForm.appendChild(submitBtn);

        // Handle questions submission
        qForm.addEventListener('submit', async ev => {
          ev.preventDefault();
          // Build payload from both forms
          const payload = {
            name: form.name.value,
            email: form.email.value,
            age: form.age.value,
            talent: talentValue,
            height: form.height.value,
            weight: form.weight.value,
            answers: Object.fromEntries(new FormData(qForm))
          };

          // Send to Google Sheets
          fetch(SHEET_ENDPOINT, {
            method: 'POST', mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          }).catch(err => console.error('Error storing to sheet', err));

          // Show success modal
          qSection.classList.add('hidden');
          document.getElementById('successModal').style.display = 'flex';
        });
      });

      // Close modal and reload page
      document.getElementById('closeModal').addEventListener('click', () => {
        document.getElementById('successModal').style.display = 'none';
        location.reload();
      });
    }

    // Start initialization on page load
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
